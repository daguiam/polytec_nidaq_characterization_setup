# Characterization setup using NI DAQ systems 




# Requisites

- NI-DAQmx Python https://nidaqmx-python.readthedocs.io/en/latest/

```
$ python -m pip install nidaqmx
```

- Ni-DAQmx drivers

https://www.ni.com/pt-pt/support/downloads/drivers/download.ni-daq-mx.html#480879




# Getting Started


Open `Polytec_NIDAQ_Acquisition.ipynb`


This script connects to a NI USB-6363 Data Acquisition board to generate an actuation signal, and measure the respective vibrometer data of a Polytec MSA-500 system

## Description
1. Actuation signal is generated by the DAQ
2. A copy reference of the actuation signal is acquired by the DAQ
3. The physical actuation signal is amplified and drives the device under test
4. The Polytec MSA-500 is configured using the system software, and the Detector and other configurations must be defined in this script
5. The script loop generates the actuation signal, and measures the corresponding reference and vibrometer signal
6. The acquired signal and configuration settings are stored in a json file
7. The json file can then be read with the analysis scripts


## Setup:
1. Place device under Polytec microscope and attach actuation cables
2. Connect the output channel of the DAQ system to amplifier (if needed) and then to the device under test.
3. Connect the vibrometer output channel from the polytec to the input channels of the DAQ system
4. Configure the detection parameters on the Polytec system (displacement or vibrometer, detector range)
5. Open the `Polytec_NIDAQ_Acquisition.ipynb` script, and update the parameters accordingly to reflect the configuration on the json file.
6. Execute the loop acquisition to record the system response to the actuation signal

## Experimental Considerations
- The DAQ system can capture up to 2MSps on a single channel, or less for multipel channels (they are multiplexes). The NIDAQmx library gives a warning when unable to cope with acquisiton timings, so reduce sampling rate accordingly.
- The DAQ system cannot feed a 50Ω input impedance up to ±10V (max output current is around 20mA). 
- If more than ±10V are needed, the PA85 HF HV amplifier can be used after the DAQ, before driving the actuation of the driving system. 
- The PA85 HF HV amplifier  can run up to ±200V or up to 0-400V at 200mA, up to 1MHz. 
- The HF HV amplifier has a fixed gain of around 53 V/V.
- The HF HV amplifier is DC coupled.
- For piezo or electrostatic signals, a DC coupled amplified signal from 0 to [Max Voltage] is to be amplified.
- Do not connect the output of the HF HV amplifier to the DAQ system or to the polytec. The high voltages will for sure damage the equipments. If a reference of the driving signal is to be used, capture it directly from the output of the DAQ, before the amplifier. However, consider that this reference have an offset phase to the captured vibrometer for higher frequencies due to the amplifier phase not being considered.
- The displacement measurement of the Polytec MSA-500 has a low frequency drift, which affects the measurement specially in the displacement measurement for low frequencies. This results in voltage signal increasing until clipping at ±10V and/or retunring to zero, depending on configuration. The Polytec MSA-500 only has digital filtering to reduce this effect. 
- There are inline coaxial DC blockers filters and 50/60Hz - 100/120Hz power line filters that can be connected to the input of the Polytec acquisition systen, after the vibrometer. These will prevent the low frequency drift. These have a usable frequency >1kHz.
- The Polytec MSA-500 system also has some spurious high frequency noise signals at >1MHz which can influence the measurement, specially for low amplitude signals of the vibrometer
- There are also inline coaxial Low pass filters (<500 kHz) that can reduce these spurious signals to some extent. These can be connected to the input of the Polytec acquisition system.






